{"name": "test_customer_rank_case[D]", "status": "broken", "statusDetails": {"message": "KeyError: 'total'", "trace": "self = <test_dir.test_customer.TestCustomer object at 0x0000000004BA3490>, browser = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"492c337df9b38dc130d28ad4b44d1af5\")>, base_url = 'http://newtest.elinkbuy.cn', client_rank = 'D'\n\n    @pytest.mark.parametrize(\n        \"client_rank\",\n        ['A', 'B', 'C', 'D']\n    )\n    def test_customer_rank_case(self, browser, base_url, client_rank):\n        \"\"\"\n        模拟点击客户等级下拉框筛选客户\n        \"\"\"\n        self.login(browser, base_url)\n        self.page = CustomerPage(browser)\n        flag = self.close_layer()  # 关闭弹层\n        if flag:\n            self.page.customer_menu.click()  # 点击客户管理菜单栏\n        else:\n            print(\"弹层关闭失败\")\n        self.page.customer_list.click()  # 点击客户列表菜单\n        self.page.search_client_rank.select_by_visible_text(client_rank)  # 选择客户等级A\n        self.page.search_btn.click()  # 点击搜索按钮\n        sleep(2)\n    \n        pagination = self.page.pagination  # 分页\n        if len(pagination) > 0:\n            self.page.window_scroll(None, 1000)\n            self.page.last_page.click()  # 点击最后一页\n            sleep(2)\n    \n        total_text = int(self.page.last_sort.text)\n        result = 0\n        db_conn = DB(ip='47.103.83.160', user='root', passwd='c587024e9ec3ea0a', db='ylg')\n        user = self.get_user()\n        sql = \"SELECT count(1) FROM `xy_client` WHERE  `staff_id` = 5  AND `clientkind` = 1  AND `tradekindid` <> 2  AND `closed` = 'F'  AND `client_rank` ='\" + client_rank + \"'\"\n        if user['roles_str'] in [87, 91]:\n            sql = \"SELECT count(1) total FROM `xy_client` WHERE  `staff_id` = 5  AND `clientkind` = 1  AND `tradekindid` <> 2  AND `closed` = 'F'  AND `client_rank` ='\" + client_rank + \"' and `high_quality` = 0\"\n        clients = db_conn.query(sql)\n        if clients:\n>           result = clients[0]['total']\nE           KeyError: 'total'\n\ntest_dir\\test_customer.py:106: KeyError"}, "description": "\n        模拟点击客户等级下拉框筛选客户\n        ", "steps": [{"name": "添加失败截图...", "status": "passed", "attachments": [{"name": "失败截图", "source": "b6cdd73d-98aa-47c2-9adb-5a02c504efe0-attachment.png", "type": "image/png"}], "start": 1627547604603, "stop": 1627547604785}], "attachments": [{"name": "log", "source": "1c247763-2ca5-4af7-ab6a-acc471f7a0fc-attachment.txt", "type": "text/plain"}, {"name": "stdout", "source": "1269b859-9813-4400-84db-b358ab41881a-attachment.txt", "type": "text/plain"}], "parameters": [{"name": "client_rank", "value": "'D'"}], "start": 1627547563826, "stop": 1627547604389, "uuid": "8835cfbf-6377-4e09-93ac-b07b03f5e2bf", "historyId": "1678a1ae6f4d92fd06527318d58b2f9e", "testCaseId": "2557c83fea2a8df2cd5b3c1e30802719", "fullName": "test_dir.test_customer.TestCustomer#test_customer_rank_case", "labels": [{"name": "parentSuite", "value": "test_dir"}, {"name": "suite", "value": "test_customer"}, {"name": "subSuite", "value": "TestCustomer"}, {"name": "host", "value": "Win7-2019MNTZRK"}, {"name": "thread", "value": "11872-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "test_dir.test_customer"}]}