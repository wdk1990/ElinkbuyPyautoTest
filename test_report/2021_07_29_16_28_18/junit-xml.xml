<?xml version="1.0" encoding="utf-8"?><testsuites><testsuite name="pytest" errors="0" failures="4" skipped="0" tests="4" time="308.260" timestamp="2021-07-29T16:28:18.693445" hostname="Win7-2019MNTZRK"><testcase classname="test_dir.test_customer.TestCustomer" name="test_customer_rank_case[A]" time="77.909"><failure message="KeyError: 'total'">self = &lt;test_dir.test_customer.TestCustomer object at 0x0000000004B54520&gt;, browser = &lt;selenium.webdriver.chrome.webdriver.WebDriver (session="afa25724283f58a8cebb964766c77ea6")&gt;, base_url = 'http://newtest.elinkbuy.cn', client_rank = 'A'

    @pytest.mark.parametrize(
        "client_rank",
        ['A', 'B', 'C', 'D']
    )
    def test_customer_rank_case(self, browser, base_url, client_rank):
        """
        模拟点击客户等级下拉框筛选客户
        """
        self.login(browser, base_url)
        self.page = CustomerPage(browser)
        flag = self.close_layer()  # 关闭弹层
        if flag:
            self.page.customer_menu.click()  # 点击客户管理菜单栏
        else:
            print("弹层关闭失败")
        self.page.customer_list.click()  # 点击客户列表菜单
        self.page.search_client_rank.select_by_visible_text(client_rank)  # 选择客户等级A
        self.page.search_btn.click()  # 点击搜索按钮
        sleep(2)
    
        pagination = self.page.pagination  # 分页
        if len(pagination) &gt; 0:
            self.page.window_scroll(None, 1000)
            self.page.last_page.click()  # 点击最后一页
            sleep(2)
    
        total_text = int(self.page.last_sort.text)
        result = 0
        db_conn = DB(ip='47.103.83.160', user='root', passwd='c587024e9ec3ea0a', db='ylg')
        user = self.get_user()
        sql = "SELECT count(1) FROM `xy_client` WHERE  `staff_id` = 5  AND `clientkind` = 1  AND `tradekindid` &lt;&gt; 2  AND `closed` = 'F'  AND `client_rank` ='" + client_rank + "'"
        if user['roles_str'] in [87, 91]:
            sql = "SELECT count(1) total FROM `xy_client` WHERE  `staff_id` = 5  AND `clientkind` = 1  AND `tradekindid` &lt;&gt; 2  AND `closed` = 'F'  AND `client_rank` ='" + client_rank + "' and `high_quality` = 0"
        clients = db_conn.query(sql)
        if clients:
&gt;           result = clients[0]['total']
E           KeyError: 'total'

test_dir\test_customer.py:106: KeyError</failure></testcase><testcase classname="test_dir.test_customer.TestCustomer" name="test_customer_rank_case[B]" time="74.588"><failure message="KeyError: 'total'">self = &lt;test_dir.test_customer.TestCustomer object at 0x0000000004B78DC0&gt;, browser = &lt;selenium.webdriver.chrome.webdriver.WebDriver (session="afa25724283f58a8cebb964766c77ea6")&gt;, base_url = 'http://newtest.elinkbuy.cn', client_rank = 'B'

    @pytest.mark.parametrize(
        "client_rank",
        ['A', 'B', 'C', 'D']
    )
    def test_customer_rank_case(self, browser, base_url, client_rank):
        """
        模拟点击客户等级下拉框筛选客户
        """
        self.login(browser, base_url)
        self.page = CustomerPage(browser)
        flag = self.close_layer()  # 关闭弹层
        if flag:
            self.page.customer_menu.click()  # 点击客户管理菜单栏
        else:
            print("弹层关闭失败")
        self.page.customer_list.click()  # 点击客户列表菜单
        self.page.search_client_rank.select_by_visible_text(client_rank)  # 选择客户等级A
        self.page.search_btn.click()  # 点击搜索按钮
        sleep(2)
    
        pagination = self.page.pagination  # 分页
        if len(pagination) &gt; 0:
            self.page.window_scroll(None, 1000)
            self.page.last_page.click()  # 点击最后一页
            sleep(2)
    
        total_text = int(self.page.last_sort.text)
        result = 0
        db_conn = DB(ip='47.103.83.160', user='root', passwd='c587024e9ec3ea0a', db='ylg')
        user = self.get_user()
        sql = "SELECT count(1) FROM `xy_client` WHERE  `staff_id` = 5  AND `clientkind` = 1  AND `tradekindid` &lt;&gt; 2  AND `closed` = 'F'  AND `client_rank` ='" + client_rank + "'"
        if user['roles_str'] in [87, 91]:
            sql = "SELECT count(1) total FROM `xy_client` WHERE  `staff_id` = 5  AND `clientkind` = 1  AND `tradekindid` &lt;&gt; 2  AND `closed` = 'F'  AND `client_rank` ='" + client_rank + "' and `high_quality` = 0"
        clients = db_conn.query(sql)
        if clients:
&gt;           result = clients[0]['total']
E           KeyError: 'total'

test_dir\test_customer.py:106: KeyError</failure></testcase><testcase classname="test_dir.test_customer.TestCustomer" name="test_customer_rank_case[C]" time="73.301"><failure message="KeyError: 'total'">self = &lt;test_dir.test_customer.TestCustomer object at 0x00000000049CBCA0&gt;, browser = &lt;selenium.webdriver.chrome.webdriver.WebDriver (session="afa25724283f58a8cebb964766c77ea6")&gt;, base_url = 'http://newtest.elinkbuy.cn', client_rank = 'C'

    @pytest.mark.parametrize(
        "client_rank",
        ['A', 'B', 'C', 'D']
    )
    def test_customer_rank_case(self, browser, base_url, client_rank):
        """
        模拟点击客户等级下拉框筛选客户
        """
        self.login(browser, base_url)
        self.page = CustomerPage(browser)
        flag = self.close_layer()  # 关闭弹层
        if flag:
            self.page.customer_menu.click()  # 点击客户管理菜单栏
        else:
            print("弹层关闭失败")
        self.page.customer_list.click()  # 点击客户列表菜单
        self.page.search_client_rank.select_by_visible_text(client_rank)  # 选择客户等级A
        self.page.search_btn.click()  # 点击搜索按钮
        sleep(2)
    
        pagination = self.page.pagination  # 分页
        if len(pagination) &gt; 0:
            self.page.window_scroll(None, 1000)
            self.page.last_page.click()  # 点击最后一页
            sleep(2)
    
        total_text = int(self.page.last_sort.text)
        result = 0
        db_conn = DB(ip='47.103.83.160', user='root', passwd='c587024e9ec3ea0a', db='ylg')
        user = self.get_user()
        sql = "SELECT count(1) FROM `xy_client` WHERE  `staff_id` = 5  AND `clientkind` = 1  AND `tradekindid` &lt;&gt; 2  AND `closed` = 'F'  AND `client_rank` ='" + client_rank + "'"
        if user['roles_str'] in [87, 91]:
            sql = "SELECT count(1) total FROM `xy_client` WHERE  `staff_id` = 5  AND `clientkind` = 1  AND `tradekindid` &lt;&gt; 2  AND `closed` = 'F'  AND `client_rank` ='" + client_rank + "' and `high_quality` = 0"
        clients = db_conn.query(sql)
        if clients:
&gt;           result = clients[0]['total']
E           KeyError: 'total'

test_dir\test_customer.py:106: KeyError</failure></testcase><testcase classname="test_dir.test_customer.TestCustomer" name="test_customer_rank_case[D]" time="76.033"><failure message="KeyError: 'total'">self = &lt;test_dir.test_customer.TestCustomer object at 0x0000000004BA3490&gt;, browser = &lt;selenium.webdriver.chrome.webdriver.WebDriver (session="492c337df9b38dc130d28ad4b44d1af5")&gt;, base_url = 'http://newtest.elinkbuy.cn', client_rank = 'D'

    @pytest.mark.parametrize(
        "client_rank",
        ['A', 'B', 'C', 'D']
    )
    def test_customer_rank_case(self, browser, base_url, client_rank):
        """
        模拟点击客户等级下拉框筛选客户
        """
        self.login(browser, base_url)
        self.page = CustomerPage(browser)
        flag = self.close_layer()  # 关闭弹层
        if flag:
            self.page.customer_menu.click()  # 点击客户管理菜单栏
        else:
            print("弹层关闭失败")
        self.page.customer_list.click()  # 点击客户列表菜单
        self.page.search_client_rank.select_by_visible_text(client_rank)  # 选择客户等级A
        self.page.search_btn.click()  # 点击搜索按钮
        sleep(2)
    
        pagination = self.page.pagination  # 分页
        if len(pagination) &gt; 0:
            self.page.window_scroll(None, 1000)
            self.page.last_page.click()  # 点击最后一页
            sleep(2)
    
        total_text = int(self.page.last_sort.text)
        result = 0
        db_conn = DB(ip='47.103.83.160', user='root', passwd='c587024e9ec3ea0a', db='ylg')
        user = self.get_user()
        sql = "SELECT count(1) FROM `xy_client` WHERE  `staff_id` = 5  AND `clientkind` = 1  AND `tradekindid` &lt;&gt; 2  AND `closed` = 'F'  AND `client_rank` ='" + client_rank + "'"
        if user['roles_str'] in [87, 91]:
            sql = "SELECT count(1) total FROM `xy_client` WHERE  `staff_id` = 5  AND `clientkind` = 1  AND `tradekindid` &lt;&gt; 2  AND `closed` = 'F'  AND `client_rank` ='" + client_rank + "' and `high_quality` = 0"
        clients = db_conn.query(sql)
        if clients:
&gt;           result = clients[0]['total']
E           KeyError: 'total'

test_dir\test_customer.py:106: KeyError</failure></testcase></testsuite></testsuites>